"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[581],{8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>c});var n=s(6540);const i={},r=n.createContext(i);function o(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:t},e.children)}},9251:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"migration/version-5","title":"Version 5 Migration Guide","description":"Let\'s start with the good news: the are no significant breaking changes.","source":"@site/docs/migration/version-5.md","sourceDirName":"migration","slug":"/migration/version-5","permalink":"/sentry-testkit/docs/migration/version-5","draft":false,"unlisted":false,"editUrl":"https://github.com/zivl/sentry-testkit/blob/master/website/docs/docs/migration/version-5.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Version 3 Migration Guide","permalink":"/sentry-testkit/docs/migration/version-3"},"next":{"title":"Version 6 Migration Guide","permalink":"/sentry-testkit/docs/migration/version-6"}}');var i=s(4848),r=s(8453);const o={},c="Version 5 Migration Guide",a={},l=[{value:"Moving Sentry Testkit to TypeScript",id:"moving-sentry-testkit-to-typescript",level:2},{value:"(Maybe) Breaking Changes [UPDATE: Fixed!]",id:"maybe-breaking-changes-update-fixed",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"version-5-migration-guide",children:"Version 5 Migration Guide"})}),"\n",(0,i.jsxs)(t.p,{children:["Let's start with the good news: ",(0,i.jsx)(t.strong,{children:"the are no significant breaking changes."})]}),"\n",(0,i.jsxs)(t.h2,{id:"moving-sentry-testkit-to-typescript",children:["Moving Sentry Testkit to ",(0,i.jsx)(t.a,{href:"https://www.typescriptlang.org/",children:"TypeScript"})]}),"\n",(0,i.jsx)(t.p,{children:"We refactored our entire code base to support TypeScript language. We have done so for the following reasons:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"Type safe system. Eventually there is a great advantage to work in a type-safe ecosystem."}),"\n",(0,i.jsx)(t.li,{children:"By having type safe functionality, we beleive it will encourage more deveopers to understand the code and be able to contribute more features and bug fixes."}),"\n",(0,i.jsx)(t.li,{children:"Using TypeScript also helps code editors (IDEs) to provide better code-auto-completion functionality as well as self-documenting function parameters and etc."}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"maybe-breaking-changes-update-fixed",children:"(Maybe) Breaking Changes [UPDATE: Fixed!]"}),"\n",(0,i.jsxs)(t.p,{children:["Unfortunately, due to some race condition or wrong definition, we can't get to run out tests on the built-in ",(0,i.jsx)(t.code,{children:"jest-mock"})," functionality.\nTo remind, it was possible if you're using ",(0,i.jsx)(t.code,{children:"Jest"})," for testing, all you have to do in your ",(0,i.jsx)(t.code,{children:"***.spec.js"})," file is to import the Jest mock as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"// some.spec.js\nimport { testkit } from 'sentry-testkit/dist/jestMock';\n\ntest('something', function () {\n    // click\n    // clack\n    // BOOM!\n    expect(testkit.reports().length).toBeGreaterThan(0);\n});\n"})}),"\n",(0,i.jsx)(t.p,{children:"But we're having issue with that:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["We're getting errors ",(0,i.jsx)(t.code,{children:"Sentry is not defined"})," and ",(0,i.jsx)(t.code,{children:"Maximum call stack size exceeded"})," (looks like circular dep): ",(0,i.jsx)(t.a,{href:"https://github.com/zivl/sentry-testkit/runs/2477315004",children:"https://github.com/zivl/sentry-testkit/runs/2477315004"})]}),"\n",(0,i.jsxs)(t.li,{children:["re-declaring block-scope variables (looks like es imports helps with this, but then we got into first problem): ",(0,i.jsx)(t.a,{href:"https://github.com/zivl/sentry-testkit/pull/78/checks?check_run_id=2826583066",children:"https://github.com/zivl/sentry-testkit/pull/78/checks?check_run_id=2826583066"})]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["You may refer to the source code of ",(0,i.jsx)(t.a,{href:"https://github.com/zivl/sentry-testkit/blob/master/src/jestMock.ts",children:(0,i.jsx)(t.code,{children:"jestMock.ts"})})," and we'll be happy for your help and suggestions."]}),"\n",(0,i.jsxs)(t.p,{children:["For further details and discussion, please follow ",(0,i.jsx)(t.a,{href:"https://github.com/zivl/sentry-testkit/issues/136",children:"issue #136"})]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"[UPDATE]"}),": Thanks to ",(0,i.jsx)(t.a,{href:"https://github.com/liamjones",children:"@liamjones"}),"'s contribution, this issue is no longer exists and you maybe upgrade your ",(0,i.jsx)(t.code,{children:"sentry-testkit"})," versions safely!"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);